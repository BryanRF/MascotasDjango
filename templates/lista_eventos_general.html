{% extends 'base/layout.html' %} {% load static %} {% block content %}

<link
  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-1.13.6/b-2.4.2/r-2.5.0/sb-1.6.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.css"
  rel="stylesheet"
/>

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-1.13.6/b-2.4.2/r-2.5.0/sb-1.6.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.js"></script>
<link href="{% static 'assets/css/theme.css' %}" rel="stylesheet" />
<section class="py-5 bg-warning" style="height: 100vh;">
  <div class="container bg-warning">
    <div class="heading_container heading_center">
      <div class="col-lg-6 text-center mx-auto mb-3 mb-md-5 mt-4">
        <h5
          class="fw-bold text-white badge-back te fs-3 fs-lg-5 lh-sm badge bg-dark ,l-"
        >
          Eventos de Recaudacion de fondos
        </h5>
      </div>
    </div>
    <div class="filters-content container bg-white card p-3">
      <table id="eventosTable" class="w-100 table">
        <thead>
          <tr>
            <th>Nombre Evento</th>
            <th>Codigo</th>
            <th>Fecha Inicio</th>
            <th>Fecha Fin Participación</th>
            <th>Costo Participación</th>
            <th>Recaudacion Actual</th>
            <th>Estado de evento</th>
            <th>Premios</th><th>Ganadores</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <script>
         
         $(document).ready(function() {
    const eventosTable = $('#eventosTable').DataTable({
        "responsive": "true",
        "ajax": {
            "url": "{%url 'eventos_general_info' %}",
            "dataSrc": ""
        },
        "columns": [
            { "data": "nombre_evento" },
            {
                        "data": "codigo",
                        "render": function(data, type, row) {
                            return '<button class="btn btn-primary btn-sm btn-copy" data-codigo="' + data + '">' + data + '</button>';
                        }
                    },
            { "data": "fecha_inicio" },
            { "data": "fecha_fin_participacion" },
            { "data": "costo_participacion" },
            { "data": "recaudacion" },
            { 
                "data": "finalizo",
                "render": function(data) {
                    return data ? '<span class="badge bg-danger">Finalizado</span>' : '<span class="badge bg-success">Activo</span>';
                }
            },
            {
                "data": "tiene_premio",
                "render": function(data, type, row) {
                    if (data) {
                        return '<button class="btn btn-primary btn-sm btn-show-premios" data-premios="' + row.premios + '">Ver Premios</button>';
                    } else {
                        return '<button class="btn btn-secondary btn-sm" disabled>Sin Premios</button>';
                    }
                }
            },
            {
                "data": "finalizo",
                "render": function(data, type, row) {
                    if (data) {
                        return '<button class="btn btn-primary btn-sm btn-show-ganadores" data-ganadores="' + row.ganadores + '">Ver Ganadores</button>';
                    } else {
                        if(row.tiene_premio){ return '<button class="btn btn-danger btn-sm" disabled>Aun no finalizo</button>';}
                        else{ return '<button class="btn btn-secondary btn-sm" disabled>Sin ganadores</button>';}
                       
                    }
                }
            },
                
        ],
        "language": {
            "sProcessing":     "Procesando...",
            "sLengthMenu":     "Mostrar _MENU_ registros",
            "sZeroRecords":    "No se encontraron resultados",
            "sEmptyTable":     "Ningún dato disponible en esta tabla",
            "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
            "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
            "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
            "sInfoPostFix":    "",
            "sSearch":         "Buscar:",
            "sUrl":            "",
            "sInfoThousands":  ",",
            "sLoadingRecords": "Cargando...",
            "oPaginate": {
                "sFirst":    "Primero",
                "sLast":     "Último",
                "sNext":     "Siguiente",
                "sPrevious": "Anterior"
            },
            "oAria": {
                "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
                "sSortDescending": ": Activar para ordenar la columna de manera descendente"
            },
        },
    });

    $('#eventosTable').on('click', '.btn-show-premios', function() {
        var premios = $(this).data('premios').split(', ');
        var premiosHtml = '<ul class="container">';
        for (var i = 0; i < premios.length; i++) {
            premiosHtml += '<li>' + premios[i] + '</li>';
        }
        premiosHtml += '</ul>';

        Swal.fire({
            confirmButtonColor: '#FFB30E',
            title: 'Premios del Evento',
            html: premiosHtml,
            confirmButtonText: 'Cerrar'
        });
    });
    eventosTable.on('click', '.btn-show-ganadores', function() {
                var premiosHtml = $(this).data('ganadores');
                Swal.fire({
                    confirmButtonColor: '#FFB30E',
                    title: 'Ganadores del Evento',
                    html: premiosHtml,
                    confirmButtonText: 'Cerrar'
                });
            });
            eventosTable.on('click', '.btn-copy', function() {
    var codigo = $(this).data('codigo');

    var tempInput = document.createElement('input');
    tempInput.value = codigo;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);

    Swal.fire({
        position: 'top-end',
        icon: 'success',
        title: '¡Código copiado!',
        showConfirmButton: false,
        timer: 1500
    });
});
  
});





      function mostrarImagen(url) {
        Swal.fire({
            imageUrl: url,
            imageWidth: 400,
            imageHeight: 300,
            imageAlt: 'Imagen de mascota',
            showCloseButton: true,
            confirmButtonText: 'Cerrar'
        });
      }
      // Agrega este código después de inicializar la tabla DataTable
     
    </script>
  </div>
</section>
{% endblock %}
<!-- end client section -->
